<% if !army.id.nil? %>
  <div id="result" class="card mb-3 border-primary bg-dark text-white">
    <div class="card-body">
      <div class="card-title">
        <button type="button" id="copy_army" class="btn-no-style text-light float-end me-1" aria-label="Copy" data-bs-toggle="tooltip" data-bs-placement="top" title="Copiar ejército">
          <i class="bi bi-clipboard2-fill"></i>
        </button>
      </div>
      <p class="card-text">
        <%= army&.name %> (<i class="bi bi-award"></i><%= army&.strength %>)

        <%= render 'army_traits', army: army %>

        <% if @current_user&.is_master? %>
          [id: #<%= sprintf('%04d', army.id) %>]
        <% end %>
      </p>

      <p class="card-text">
        Este ejército está compuesto por <%= (@options["soldiers"] * ( army.hp.to_f / 100)).to_i %> hombres y tiene una fuerza de combate&nbsp;<i class="bi bi-award"></i><%= army.strength %>
      </p>

      <% men = @men.keys %>
      <% army.composition.each_with_index do | soldiers, index | %>
        <% if soldiers.nonzero? %>
          <p class="ms-3 card-text"><%= (soldiers * army.hp.to_f * 0.1).to_i %> <%= @men[men[index]]["name"] %></p>
        <% end %>
      <% end %>

      <div class="d-none" id="army-data">
        <% traits = [] %>
        <% ((100 - army.hp) / @options["hp"]["step"])&.nonzero? ? traits << (@options["hp"]["name"].capitalize + " " + number_to_modifier(((army.hp - 100) / @options["hp"]["step"]))).html_safe : nil %>
        <% @men.each do | key, value | %>
          <% (army["men#{value['sort']}"]&.nonzero? ? traits << (value["name"].capitalize + " " + number_to_modifier(army["men#{value['sort']}"])).html_safe : nil ) %>
        <% end %>
        <% @attributes.each do | key, value | %>
          <% (army["attr#{value['sort']}"]&.nonzero? ? traits << (value["name"].capitalize + " " + number_to_modifier(army["attr#{value['sort']}"])).html_safe : nil ) %>
        <% end %>
        <% if army.tags.present? %>
          <% army.tags.each do | tag | %>
            <% if @tags[tag] %>
              <% traits << @tags[tag]["name"].capitalize %>
            <% else %>
              <% traits << tag.capitalize %>
            <% end %>
          <% end %>
        <% end %>
        <%= army.name %> (<%= @options["status"].fetch(army.status, {}).fetch("name", army.status) %>)
        <%= army.position.blank? ? nil : ", en #{army.position} " %>
        <%= army.group.blank? ? nil : " grupo " + ARMY_GROUPS[army.group.to_sym][:name].upcase %>
        <%= traits.blank? ? nil : " [" + traits.join(", ") + "] " %>
        FUE: <%= army.strength %>
      </div>
    </div>
  </div>
<% end %>
