$('.created').remove();
$.fn.addFactorToList();
$.fn.recalculateFactors();

$('#result').addClass('d-none')

$('#title').html("<%= @recipe.name %>")
$('#recipe_id').val(<%= @recipe&.id %>)
$('#difficulty').val(<%= @recipe&.difficulty %>)
$('#desc').html("<%= @recipe&.description&.html_safe %>")

<% @recipe.factors["plus_double"]&.each do | factor | %>
  $('#factors-group').append(
      `<div class='ms-1 mb-1 factor-toggle btn btn-sm btn-outline-primary flex-fill me-2 created' data-factor='3'>
      <span class='factor-data'><u>◻️<%= factor.capitalize %></u></span>
      </div>`
    )
<% end %>
<% @recipe.factors["plus_simple"]&.each do | factor | %>
  $('#factors-group').append(
    `<div class='ms-1 mb-1 factor-toggle btn btn-sm btn-outline-primary flex-fill me-2 created' data-factor='1'>
    <span class='factor-data'>◻️<%= factor.capitalize %></span>
    </div>`
    )
<% end %>
<% @recipe.factors["plus_multiple"]&.each do | factor | %>
  $('#factors-group').append(
    `<div class='ms-1 mb-1 factor btn btn-sm btn-outline-primary flex-fill me-2 created' data-factor='1'>
      <span class='factor-data'>◻️<%= factor.capitalize %></span>
      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning">
        0
      </span>
    </div>`
    )
<% end %>
<% @recipe.factors["minus_double"]&.each do | factor | %>
  $('#factors-group').append(
      `<div class='ms-1 mb-1 factor-toggle btn btn-sm btn-outline-danger flex-fill me-2 created' data-factor='-3'>
      <span class='factor-data'><u>◼️<%= factor.capitalize %></u></span>
      </div>`
    )
<% end %>
<% @recipe.factors["minus_simple"]&.each do | factor | %>
  $('#factors-group').append(
      `<div class='ms-1 mb-1 factor-toggle btn btn-sm btn-outline-danger flex-fill me-2 created' data-factor='-1'>
      <span class='factor-data'>◼️<%= factor.capitalize %></span>
      </div>`
    )
<% end %>
<% @recipe.factors["minus_multiple"]&.each do | factor | %>
  $('#factors-group').append(
    `<div class='ms-1 mb-1 factor btn btn-sm btn-outline-danger flex-fill me-2 created' data-factor='-1'>
      <span class='factor-data'>◻️<%= factor.capitalize %></span>
      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning">
        0
      </span>
    </div>`
    )
<% end %>

// Long press event
$('.factor.created').longpress(function() {
    $.fn.changeFactor($(this),-1);
});

// Click event
$('.factor.created').click(function(event) {
  if (event.ctrlKey) {
    $.fn.changeFactor($(this),-1);
  } else {
    $.fn.changeFactor($(this),1);
  }
});

// Toggle
$('.factor-toggle').click(function(event) {
  if ($(this).hasClass('active')) {
    $.fn.changeFactor($(this),-1,true);
  } else {
    $.fn.changeFactor($(this),1);
  }
});
