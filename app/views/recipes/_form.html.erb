<div class="modal fade" id="recipeModal" tabindex="-1" role="dialog" aria-labelledby="Login" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content bg-dark text-light">
      <%= form_with model: recipe, local: false do |form| %>
        <div class="modal-header">
          <h5 class="modal-title w-100" id="Title"><%= recipe&.name %></h5>
          <% if recipe.id %>
            <div class="w-100">
              <%= link_to '', send("recipe_path", recipe.id), remote: true, class: 'btn-Close bi bi-eye-fill text-white float-end' %>
            </div>
          <% end %>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="input-group mb-3">
            <%= form.label :name, class: 'input-group-text' %>
            <%= form.text_field :name, class: 'form-control' %>
          </div>
          <div class="input-group mb-3">
            <%= form.label :section, class: 'input-group-text' %>
            <%= form.select :section, options_for_select(@options_missions["sections"], @recipe.section), {}, class: 'form-select' %>
          </div>
          <div class="input-group mb-3">
            <%= form.label :speed, class: 'input-group-text' %>
            <%= form.select :speed, options_for_select(@options_missions["speed"].map { |value| [value["name"].capitalize + (value["days"].present? ? " (" + value["days"].to_s + ")" : ""), value["time"]] }, recipe.speed), {}, class: 'form-select' %>
          </div>
          <div class="input-group mb-3">
            <%= form.label :difficulty, class: 'input-group-text' %>
            <%= form.select :difficulty, options_for_select(@options_missions["difficulty"].map { |value| [value["name"].capitalize + " (" + number_to_modifier(value["value"]) + ")", value["value"]] }, recipe.difficulty), {}, class: 'form-select' %>
          </div>
          <div class="input-group mb-3">
            <%= form.label :description, class: 'input-group-text' %>
            <%= form.text_area :description, class: 'form-control', rows: 5 %>
          </div>
          <div class="input-group mb-3">
            <%= form.label :factors, class: 'input-group-text w-100' %>
          </div>
          <% ["plus", "minus"].each do |direction| %>
            <% ["simple", "double"].each do |size| %>
              <% ["once", "multiple"].each do |style| %>
                <div class="input-group mb-3">
                  <%= form.label t("activerecord.attributes.recipe.#{direction}") + " " + t("activerecord.attributes.recipe.#{size}") + " " + t("activerecord.attributes.recipe.#{style}"), class: 'input-group-text' %>
                  <%= select_tag "recipe[factors][#{direction}_#{size}_#{style}][]",
                    options_for_select(
                      recipe.factors.fetch("#{direction}_#{size}_#{style}", []).sort.map { |factor|
                        [
                          factor,
                          { "data-content": "<span class='badge pill pill-tags bg-#{direction == "plus" ? "primary" : "danger"}'><span class='pill-tags-text'>#{factor}</span></span>".html_safe }
                        ]
                      },
                      recipe.factors.fetch("#{direction}_#{size}_#{style}", [])
                    ),
                    multiple: true,
                    include_blank: false,
                    class: 'selectpicker flex-fill dropdown-toggle-custom dropdown-toggle-text-color bg-white',
                    title: t('activerecord.attributes.recipe.no_factors'),
                    data: {
                      arbitrary: true,
                      "none-results-text-arbitrary": t('messages.click_to_create').html_safe
                    }
                  %>
                </div>
              <% end %>
            <% end %>
          <% end %>
          <div class="input-group mb-3">
            <%= form.label :results, class: 'input-group-text w-100' %>
          </div>

          <% ["major", "minor", "improvement"].each_with_index do |result, index| %>
            <% color = ["danger","warning","success"] %>
            <div class="input-group mb-3">
              <%= form.label t("activerecord.attributes.recipe.results_#{result}"), class: 'input-group-text' %>
              <%= select_tag "recipe[results][#{result}][]",
                options_for_select(
                  recipe.results.fetch(result, []).map { |value|
                    [
                      value,
                      { "data-content": "<span class='badge pill pill-tags bg-#{color[index]}'><span class='pill-tags-text'>#{value}</span></span>".html_safe }
                    ]
                  },
                  recipe.results.fetch(result, [])
                ),
                multiple: true,
                include_blank: false,
                class: 'selectpicker flex-fill dropdown-toggle-custom dropdown-toggle-text-color text-dark bg-white',
                title: t('activerecord.attributes.recipe.no_results'),
                data: {
                  arbitrary: true,
                  "none-results-text-arbitrary": t('messages.click_to_create').html_safe
                }
              %>
            </div>
          <% end %>

          <div class="input-group mb-3">
            <%= form.label :game_ids, class: 'input-group-text' %>
            <%= form.select :game_ids,
              options_for_select(
                @games.map { | game |
                  [
                    game.id,
                    { "data-content": "#{image_tag(game.icon_url, alt: game.name, id: game.name, class: 'icon-select bg-secondary')} #{game.title}".html_safe
                  }
                  ]
                },
                selected: form.object.games.pluck(:id)
              ),
              { include_blank: false },
              class: 'selectpicker flex-fill dropdown-toggle-custom dropdown-toggle-text-color bg-white',
              multiple: true,
              data: { multipleSeparator: ' ', noneSelectedText: 'Elige partidas' }
            %>
          </div>

          <div class="input-group mb-3">
            <%= form.label :visible, class: 'input-group-text' %>
            <div class="form-check form-switch switch-group fs-2">
              <%= form.check_box :visible, class: 'form-check-input switch-group h-100' %>
            </div>
          </div>

          <%= form.submit nil, class: 'btn btn-primary' %>
        </div>
      <% end %>
  </div>
</div>
